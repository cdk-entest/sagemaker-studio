---
title: sagemaker estimator
description: sagemaker estimator
author: haimtran
publishedDate: 01/06/2023
date: 2022-06-01
---

## Introduction

[GitHub]() this note shows basics concepts of SageMaker Estimator API

- Estimator: Built-In Algorithm, Framework, BYOM
- Train a Built-In Algorithm
- Fine Tune a Pre-trained Algorithm (GPT-J 6B)
- Train a Framework Algorithm
- Hyper Parameter Tunning
- Deploy an Endpoing

## Estimator API

Normally, we develop a model using a framework such as neural net (NN) using a framework such as Tensorflow, PyTorch or Scikit-learn. In SageMaker, there are three main group of SageMaker Estimator.

- Built-In Algorithm => call fit to train
- Framework Algorithm => call fit(entry_point=your_script) to train
- Bring Your Own Model (BYO) => provide your own container image

## Estimator Class

An estimator is used to train a ML algorithm, and it consits of at least the following component. For a buit-in algorithm or Amazon custom algorithm, we can ignore the the container iamge uri parameter.

- Container image (container image uri)
- Instance type which run the container
- IAM Role for accessing S3 (data, code), CloudWatch logs

Let create a estimator for PCA (built-in algorithm) using the based estimator class. First we need to find the iamge uri

```py
# get sklearn image uri
image_uri = sagemaker.estimator.image_uris.retrieve(
    framework="pca",
    region=os.environ["REGION"],
    version="0.23-1",
    instance_type="ml.m4.xlarge",
)
```

Then we can create a estimator using the SageMaker based Estimator class

```py
# create an estimator
estimator = sagemaker.estimator.Estimator(
    image_uri=image_uri,
    instance_type="ml.m4.xlarge",
    instance_count=1,
    # output_path="",
    role=os.environ["SAGEMAKER_ROLE"],
)
```

Then we can train the model by calling fit method on the estimator

```py
# set hyperparameter
estimator.set_hyperparameters(
    feature_dim=4, num_components=3, mini_batch_size=200
)
```

Train the model by creating a training job either by estimator.fit() or other methods to create a training job such as Boto3, TrainingStep in a pipeline.

```py
# TODO: update
estimator.fit()
```

Finally, we can deploy the model as a endpoint and invoke it

```py

```

## Estimator Data Access

There are some options to feed training data into a estimator.fit() for training [docs](https://sagemaker.readthedocs.io/en/stable/api/training/estimators.html#sagemaker.estimator.EstimatorBase)

- Option 1. [TrainingInput](https://github.com/aws/amazon-sagemaker-examples/blob/main/introduction_to_amazon_algorithms/linear_learner_abalone/Linear_Learner_Regression_csv_format.ipynb)

```py
train_data = sagemaker.inputs.TrainingInput(
    s3_train_data,
    distribution="FullyReplicated",
    content_type="text/csv",
    s3_data_type="S3Prefix",
    record_wrapping=None,
    compression=None,
)
validation_data = sagemaker.inputs.TrainingInput(
    s3_validation_data,
    distribution="FullyReplicated",
    content_type="text/csv",
    s3_data_type="S3Prefix",
    record_wrapping=None,
    compression=None,
)
# feed data to estimator for training
linear.fit(inputs={"train": train_data, "validation": validation_data}, job_name=job_name)
```

Another example with PCA [HERE](https://cdk.entest.io/ml/pca-sagemaker)

```py
# pca image uri
image_uri = image_uris.retrieve(
    framework="pca",
    region=os.environ["REGION"],
    instance_type="t2.medium",
)
# pca estimator
pca = sagemaker.estimator.Estimator(
    role=config["SAGEMAKER_ROLE"],
    image_uri=image_uri,
    instance_count=1,
    instance_type="ml.c4.xlarge",
)
# set pca parameters
pca.set_hyperparameters(
    feature_dim=4,
    num_components=3,
    mini_batch_size=200,
)
# train the model
pca.fit(
    inputs={
        "train": TrainingInput(
            content_type="text/csv;label_size=0",
            s3_data=f"s3://{config['SAGEMAKER_BUCKET']}/pca-processed-data",
        )
    }
)
```

- Option 2. [S3 Data Location](https://github.com/aws/amazon-sagemaker-examples/blob/main/introduction_to_amazon_algorithms/pca_mnist/pca_mnist.ipynb)

```py
s3_train_data = f"s3://{bucket}/{prefix}/train/{key}"

pca = sagemaker.estimator.Estimator(
    container,
    role,
    instance_count=1,
    instance_type="ml.c4.xlarge",
    output_path=output_location,
    sagemaker_session=sess,
)
pca.set_hyperparameters(
    feature_dim=50000,
    num_components=10,
    subtract_mean=True,
    algorithm_mode="randomized",
    mini_batch_size=200,
)

pca.fit(inputs={"train": s3_train_data})
```

- Option 3. [Local Mode](https://aws.amazon.com/blogs/machine-learning/use-the-amazon-sagemaker-local-mode-to-train-on-your-notebook-instance/)

```py
inputs = sagemaker_session.upload_data(path='data', bucket=bucket, key_prefix='data/cifar10')

cifar10_estimator = PyTorch(
    py_version='py3',
    entry_point='source/cifar10.py',
    role=role,
    framework_version='1.7.1',
    instance_count=1,
    instance_type='local')

cifar10_estimator.fit(inputs)
```

## Buit-In Algorithm

## Framework Algorithm

## BYO Model

## Reference

- [SM Access Data](https://docs.aws.amazon.com/sagemaker/latest/dg/model-access-training-data.html)

- [SM Training Storage Folder](https://docs.aws.amazon.com/sagemaker/latest/dg/model-train-storage.html)

- [Data Input Mode](https://docs.aws.amazon.com/sagemaker/latest/dg/model-access-training-data.html)

- [SM Enviornment Variables](https://github.com/aws/sagemaker-training-toolkit/blob/master/ENVIRONMENT_VARIABLES.md#sm_channel_channel_name)

- [SM Enviornment Variables and Tensorflow] (https://github.com/aws/amazon-sagemaker-examples/blob/main/frameworks/tensorflow/code/train.py)

- [Simple BYOM](https://github.com/aws/amazon-sagemaker-examples/blob/main/sagemaker-script-mode/sklearn/sklearn_byom_outputs.ipynb)

- [Train a Model SageMaker](https://sagemaker.readthedocs.io/en/stable/overview.html#train-a-model-with-the-sagemaker-python-sdk)

- [Train Linear Leaner](https://github.com/aws/amazon-sagemaker-examples/blob/main/introduction_to_amazon_algorithms/linear_learner_abalone/Linear_Learner_Regression_csv_format.ipynb)

- [Train PCA Input](https://github.com/aws/amazon-sagemaker-examples/blob/main/introduction_to_amazon_algorithms/pca_mnist/pca_mnist.ipynb)

- [Built-In Algorithm No Script Required](https://docs.aws.amazon.com/sagemaker/latest/dg/algorithms-choose.html)

- [SM PCA Details](https://docs.aws.amazon.com/sagemaker/latest/dg/pca.html)

- [SM Simple PCA](https://sagemaker-examples.readthedocs.io/en/latest/introduction_to_amazon_algorithms/pca_mnist/pca_mnist.html)

- [Local Mode Data Training](https://aws.amazon.com/blogs/machine-learning/use-the-amazon-sagemaker-local-mode-to-train-on-your-notebook-instance/)
